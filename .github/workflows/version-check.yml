name: Version check

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  # Confirms all version numbers match.
  versioncheck:
    name: Version Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Check three version numbers
        run: |
          MAINFILE="wp-call-button.php"
          NEWVERSION1=`grep "^Stable tag:" readme.txt | awk -F' ' '{print $NF}'`
          echo "readme.txt version: $NEWVERSION1"
          NEWVERSION2=`grep "^[ 	\*]*Version[ 	]*:[ 	]*" $MAINFILE | awk -F' ' '{print $NF}'`
          echo "$MAINFILE version: $NEWVERSION2"
          FINDSTRING="define( 'WP_CALL_BUTTON_VERSION', '$NEWVERSION2' );"
          NEWVERSION3=`grep "$FINDSTRING" $MAINFILE | awk -F' ' '{print $3}'`
          NEWVERSION3=`echo $NEWVERSION3 | sed "s/'//g"`
          echo "defined version: $NEWVERSION3"
          if [ "$NEWVERSION1" != "$NEWVERSION2" ]; then echo "Version in readme.txt & $MAINFILE don't match. Exiting...."; exit 1; fi
          if [ "$NEWVERSION3" != "$NEWVERSION2" ]; then echo "Version in define() & $MAINFILE don't match. Exiting...."; exit 1; fi
          echo "Version numbers match."


